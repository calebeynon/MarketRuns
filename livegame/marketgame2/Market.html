{{block title}} Market {{endblock}}
{{block content}}
<style>
    .otree-timer {
        display: none;
    }
    .highlight-green {
        background-color: rgb(215, 56, 56);
        transition: background-color 0.5s ease;
    }
</style>

<!-- Top Row, posterior, price, sell button, graphs -->
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
    <!-- Left: Price Info and Chart -->
    <div style="flex: 1; max-width: 48%;">
        <h3>Current Market Price: <span id="price">{{ initial_price }}</span></h3>
        <img src="{{ price_img }}" alt="Price Graph" width="400" height="400"/>
    </div>
    <!-- Center: Sell Button -->
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 0 0 180px;">
        <button id="sell-button" style="font-size: 2rem; padding: 20px 40px; margin: 30px 0; background-color: #28a745; color: white; border: none; border-radius: 8px; transition: opacity 0.3s; opacity: 0.5; cursor: not-allowed;" disabled>
            Sell
        </button>
        <div id="countdown" style="font-size: 1.2rem; margin-top: 10px;">Button activates in: <span id="timer">10</span>s</div>
        <form id="sell-form" method="post" style="display:none;">
            <input type="hidden" name="sell" value="1"/>
        </form>
        <script>
            // Initial countdown timer
            let timeLeft = 10;
            const timerElement = document.getElementById('timer');
            const countdownElement = document.getElementById('countdown');
            const sellBtn = document.getElementById('sell-button');
            const sellForm = document.getElementById('sell-form');
            sellBtn.onclick = function() {
                sellForm.submit();
            };
            const countdownInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    sellBtn.disabled = false;
                    sellBtn.style.opacity = '1';
                    sellBtn.style.cursor = 'pointer';
                    countdownElement.style.display = 'none';
                }
            }, 1000);
        </script>
    </div>
    <!-- Right: Posterior Info and Chart -->
    <div style="flex: 1; max-width: 48%;">
        <h3>Belief of Good State: <span id="posterior">{{ initial_prior }}</span>%</h3>
        <img src="{{ belief_img }}" alt="Belief Graph" width="400" height="400"/>
    </div>
</div>
<br>

<!-- sold status messages-->
<h4>
    Your Sold Status: <span id="self_sold">{{ 'Sold' if self_sold else 'Not Sold' }}</span><br>
</h4><br>

<!-- Bottom Row, Player Sold Status Table -->
<div style="display: flex; gap: 40px; align-items: flex-start;">
    <div>
        <h4>Player Sold Status</h4>
        <table id="status-table" border="1">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Sold</th>
                </tr>
            </thead>
            <tbody>
                {% for pid, sold in sold_status.items() %}
                <tr id="player-{{ pid }}">
                    <td>Player {{ pid }}:&nbsp</td>
                    <td>{{ 'Yes' if sold else 'No' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{{endblock}}